<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>건어 암호 변환기 (v1 / v2 / v3)</title>

  <style>
    body {
      font-family: "Noto Sans KR", system-ui, sans-serif;
      background: #111;
      color: #eee;
      padding: 20px;
    }

    h1 {
      margin-bottom: 12px;
    }

    textarea {
      width: 100%;
      height: 90px;
      font-size: 16px;
      font-family: inherit;
      padding: 10px;
      box-sizing: border-box;
      background: #1e1e1e;
      color: #eee;
      border: 1px solid #444;
      border-radius: 6px;
    }

    .result {
      margin-top: 16px;
      padding: 12px;
      background: #1a1a1a;
      border-radius: 6px;
      white-space: pre-wrap;
      font-family: inherit;
    }

    .label {
      font-weight: bold;
      margin-bottom: 6px;
      display: block;
      color: #8fd3ff;
    }
  </style>
</head>

<body>
  <h1>건어 암호 변환기</h1>

  <textarea id="input" placeholder="여기에 텍스트를 입력해"></textarea>

  <div class="result">
    <span class="label">v1 (5진법 · 한글만)</span>
    <div id="out-v1"></div>
  </div>

  <div class="result">
    <span class="label">v2 (8진법 · 한글만)</span>
    <div id="out-v2"></div>
  </div>

  <div class="result">
    <span class="label">v3 (11038진법 → 8진법)</span>
    <div id="out-v3"></div>
  </div>

  <script>
    /* =====================
       공통 데이터
    ===================== */

    // 완성형 한글
    const HANGUL_BASE = 0xAC00;
    const HANGUL_END  = 0xD7A3;
    const HANGUL_COUNT = HANGUL_END - HANGUL_BASE + 1;

    // 건어 문자
    const BASE5 = ["김", "건", "긁", "빌", "깋"];
    const BASE8 = ["김", "건", "긁", "빌", "깋", "히", "하", "알"];

    /* =====================
       v1: 5진법
    ===================== */
    function encodeV1(text) {
      const out = [];

      for (const ch of text) {
        const code = ch.charCodeAt(0);
        if (code < HANGUL_BASE || code > HANGUL_END) continue;

        let n = code - HANGUL_BASE;
        let encoded = "";

        do {
          encoded = BASE5[n % 5] + encoded;
          n = Math.floor(n / 5);
        } while (n > 0);

        out.push(encoded);
      }
      return out.join(" ");
    }

    /* =====================
       v2: 8진법
    ===================== */
    function encodeV2(text) {
      const out = [];

      for (const ch of text) {
        const code = ch.charCodeAt(0);
        if (code < HANGUL_BASE || code > HANGUL_END) continue;

        let n = code - HANGUL_BASE;
        let encoded = "";

        do {
          encoded = BASE8[n % 8] + encoded;
          n = Math.floor(n / 8);
        } while (n > 0);

        out.push(encoded);
      }
      return out.join(" ");
    }

    /* =====================
       v3: 11038진법 → 8진법
    ===================== */

    const TOTAL_BASE = 11038;

    function charToIndex(ch) {
      const code = ch.charCodeAt(0);
      if (code >= HANGUL_BASE && code <= HANGUL_END) {
        return code - HANGUL_BASE;
      }
      if (ch === " ") return 11037;
      return null;
    }

    function encodeV3(text) {
      const digits = [];

      for (const ch of text) {
        const idx = charToIndex(ch);
        if (idx !== null) digits.push(idx);
      }

      if (digits.length === 0) return "";

      let value = 0n;
      for (const d of digits) {
        value = value * BigInt(TOTAL_BASE) + BigInt(d);
      }

      if (value === 0n) return BASE8[0];

      let out = "";
      while (value > 0n) {
        out = BASE8[Number(value % 8n)] + out;
        value /= 8n;
      }
      return out;
    }

    /* =====================
       실시간 업데이트
    ===================== */

    const input = document.getElementById("input");
    const outV1 = document.getElementById("out-v1");
    const outV2 = document.getElementById("out-v2");
    const outV3 = document.getElementById("out-v3");

    input.addEventListener("input", () => {
      const text = input.value;
      outV1.textContent = encodeV1(text);
      outV2.textContent = encodeV2(text);
      outV3.textContent = encodeV3(text);
    });
  </script>
</body>
</html>
